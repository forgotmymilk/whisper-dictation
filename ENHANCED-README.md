# 增强版语音输入系统 (Enhanced Whisper Dictation)

## 新增功能

### 1. 中英混合输入优化
- **自动语言检测**: 智能识别中英文混合内容
- **初始提示词**: 配置中添加了中英文示例，引导模型更好处理混合语言
- **VAD语音活动检测**: 更准确识别语音边界

### 2. 中文自动标点符号
当 `enable_punctuation` 为 `true` 时：

**自动添加的标点：**
- **语气词后**: 啊、呀、哇、啦 → ！ | 呢、吧、吗 → ？
- **句首词前**: 首先、其次、然后、最后、总之等前自动添加句号
- **连接词前**: 而且、但是、因为等前自动添加逗号
- **长句切分**: 超过25字且无标点的句子自动切分

**示例：**
```
输入: 今天天气真好啊我要去公园玩然后回家吃饭
输出: 今天天气真好啊！我要去公园玩，然后回家吃饭。
```

### 3. 智能排版格式化
当 `enable_formatting` 为 `true` 时：

**自动排版功能：**
- **中英文间距**: 在中文和英文/数字之间自动添加空格，符合排版规范
  ```
  输入: 我有5个apple和3个banana
  输出: 我有 5 个 apple 和 3 个 banana
  ```

- **段落自动分段**: 
  - 识别"首先、其次、第一、第二"等标记词自动换行
  - 超过80字的长段落自动按句子分段

- **标点间距优化**: 中英文混排时正确处理标点后的空格

## 配置文件说明 (config.json)

```json
{
  "hotkey": "f15",
  "language": null,
  "model": "large-v3",
  "compute_type": "float16",
  "enable_punctuation": true,      // 启用自动标点
  "enable_formatting": true,       // 启用智能排版
  "initial_prompt": "..."          // 初始提示词，帮助识别中英文
}
```

## 启动方式

双击运行：
```
start-enhanced.bat
```

## 使用建议

### 中文输入
1. 自然说话，不用担心标点
2. 系统会自动根据语义添加逗号、句号、问号、感叹号
3. 长句会自动切分成短句，提高可读性

### 中英混合
1. 直接混说中英文，例如："这个 project 的 deadline 是明天"
2. 系统会自动优化中英文之间的空格
3. 英文单词间保持正常间距

### 排版优化
1. 系统会自动将过长的句子分段
2. 段落标记词（首先、其次等）会自动换行
3. 中英文混排会自动添加适当间距

## 注意事项

1. **标点功能**适用于中文内容，英文内容保持原有格式
2. **排版功能**会修改文本结构（添加空格、换行）
3. 如不需要某些功能，可在 `config.json` 中设为 `false`
4. 初始提示词可根据个人使用场景自定义

## 高级用法

### 禁用自动标点
编辑 `config.json`：
```json
{
  "enable_punctuation": false
}
```

### 禁用智能排版
编辑 `config.json`：
```json
{
  "enable_formatting": false
}
```

### 自定义初始提示词
初始提示词可以帮助模型更好理解你的说话风格：
```json
{
  "initial_prompt": "这是一段日常对话，包含口语化表达和标点符号。"
}
```

## 性能说明

- 自动标点和排版会增加约 50-100ms 的处理时间
- 不影响语音识别本身的准确率和速度
- 所有处理都在本地完成，无需网络
